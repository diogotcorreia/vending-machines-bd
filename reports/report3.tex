\documentclass[12pt,a4paper]{article}
\usepackage[legalpaper, portrait, margin=2cm]{geometry}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{blindtext}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{pdflscape}
\usepackage{svg}
\usepackage{listings}
\usepackage{xcolor}

\graphicspath{ {./} }
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  filecolor=magenta,
  urlcolor=blue,
  citecolor=blue,
  pdftitle={Relatório BD - Entrega 3 - 2021/2022},
  pdfpagemode=FullScreen,
}

\pagestyle{fancy}
\fancyhf{}
\rhead{Grupo \textbf{8}}
\lhead{Relatório Entrega 3 BD 2021/2022 LEIC-A}
\cfoot{Diogo Gaspar (99207), Diogo Correia (99211) e Tomás Esteves (99341)}

\renewcommand{\footrulewidth}{0.2pt}

\renewcommand{\labelitemii}{$\circ$}
\renewcommand{\labelitemiii}{$\diamond$}
\newcommand{\op}{\text}

\newlist{constraintsList}{itemize}{4}
\setlist[constraintsList]{itemsep=1pt, topsep=1pt, label=\protect\mpbullet}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}

\lstset{style=mystyle}
% https://stackoverflow.com/questions/1116266/listings-in-latex-with-utf-8-or-at-least-german-umlauts
\lstset{%
        inputencoding=utf8,
        extendedchars=true,
        literate=%
        {é}{{\'{e}}}1
        {è}{{\`{e}}}1
        {ê}{{\^{e}}}1
        {ë}{{\¨{e}}}1
        {É}{{\'{E}}}1
        {Ê}{{\^{E}}}1
        {û}{{\^{u}}}1
        {ù}{{\`{u}}}1
        {ú}{{\'{u}}}1
        {â}{{\^{a}}}1
        {à}{{\`{a}}}1
        {á}{{\'{a}}}1
        {ã}{{\~{a}}}1
        {Á}{{\'{A}}}1
        {Â}{{\^{A}}}1
        {Ã}{{\~{A}}}1
        {ç}{{\c{c}}}1
        {Ç}{{\c{C}}}1
        {õ}{{\~{o}}}1
        {ó}{{\'{o}}}1
        {ô}{{\^{o}}}1
        {Õ}{{\~{O}}}1
        {Ó}{{\'{O}}}1
        {Ô}{{\^{O}}}1
        {î}{{\^{i}}}1
        {Î}{{\^{I}}}1
        {í}{{\'{i}}}1
        {Í}{{\~{Í}}}1
}

\begin{document}
  \begin{titlepage}
    \begin{center}
      \vspace*{5cm}

      \Huge
      \textbf{Projeto BD - Parte 3}

      \vspace{0.5cm}
      \LARGE
      Grupo 008 | Turno L20 | LEIC-A

      \vspace{0.5cm}
      \large
      Prof. João Aparício | Prof. Leonardo Alexandre

      \vfill
    \end{center}
    \large
    \begin{itemize}
      \item[] \textbf{Diogo Gaspar} (99207) - 33\% - Xh
      \item[] \textbf{Diogo Correia} (99211) - 34\% - Xh
      \item[] \textbf{Tomás Esteves} (99341) - 33\% - Xh
    \end{itemize}
  \end{titlepage}

  \section*{Restrições de Integridade}

  \begin{enumerate}
    \item \textbf{(RI-1) Uma Categoria não pode estar contida em si própria.}

    \lstinputlisting[language=SQL]{sql/report3/integrity-constraints/ic1.sql}

    \item \textbf{(RI-4) O número de unidades repostas num Evento de Reposição
    não pode exceder o número de unidades especificado no Planograma.}

    \lstinputlisting[language=SQL]{sql/report3/integrity-constraints/ic2.sql}

    \item \textbf{(RI-5) Um Produto só pode ser reposto numa Prateleira que apresente
    (pelo menos) uma das Categorias desse produto.}

    \lstinputlisting[language=SQL]{sql/report3/integrity-constraints/ic3.sql}
  \end{enumerate}

  De realçar que todas as restrições de integridade descritas acima estão também
  presentes em \texttt{scripts/ICs.sql}.
  
  \section*{SQL}

  \begin{enumerate}
    \item \textbf{Qual o nome do retalhista (ou retalhistas) responsáveis pela reposição do maior número de categorias?}

    \lstinputlisting[language=SQL]{sql/report3/queries/query1.sql}

    \item \textbf{Qual o nome do ou dos retalhistas que são responsáveis por todas as categorias simples?}

    \lstinputlisting[language=SQL]{sql/report3/queries/query2.sql}

    \item \textbf{Quais os produtos (ean) que nunca foram repostos?}

    \lstinputlisting[language=SQL]{sql/report3/queries/query3.sql}

    \item \textbf{Quais os produtos (ean) que foram repostos sempre pelo mesmo retalhista?}

    \lstinputlisting[language=SQL]{sql/report3/queries/query4.sql}
  \end{enumerate}

  De realçar que todas as \textit{queries} descritas acima estão também
  presentes em \texttt{scripts/queries.sql}.

  \section*{Vistas}

  % TODO: not sure se é preciso colocar no relatório, either way fica aqui o placeholder

  \section*{Aplicação}

  % TODO: same here, não tenho a certeza se precisamos de colocar coisas nesta secção

  \section*{Consultas OLAP}

  Pretendia-se que escrevêssemos duas consultas SQL que permitissem analisar o número
  total de artigos vendidos:

  \begin{enumerate}
    \item \textbf{Num dado período (i.e. entre duas datas), por dia da semana, por concelho e no total.}
    
    \lstinputlisting[language=SQL]{sql/report3/olap-queries/olap1.sql}

    \item \textbf{Num dado distrito (i.e. “Lisboa”), por concelho, categoria, dia da semana e no total.}
  
    \lstinputlisting[language=SQL]{sql/report3/olap-queries/olap2.sql}
  \end{enumerate}

  De realçar que todas as \textit{queries} OLAP descritas acima estão também
  presentes em \\ \texttt{scripts/analytics.sql}.

  \section*{Índices}

  Foi-nos pedido, ainda, que indicássemos (justificando) os índices que faria sentido
  criar, por forma a \textit{agilizar} a execução de cada uma das \textit{queries} abaixo:

  \begin{enumerate}
    \item \textbf{Primeira \textit{query}:}
    
    \lstinputlisting[language=SQL]{sql/report3/queries/example1.sql}

    \item \textbf{Segunda \textit{query}:}
  
    \lstinputlisting[language=SQL]{sql/report3/queries/example2.sql}
  \end{enumerate}
  
\end{document}
